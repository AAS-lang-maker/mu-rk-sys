<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>榜单页</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #1E293B;
            min-height: 100vh;
            position: relative;
            color: #f7fafc;
        }

        .container {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
        }

        .header h1 {
            font-size: 36px;
            color: #fffa9c;
            margin-bottom: 20px;
        }

        .header p {
            font-size: 18px;
            color: rgba(247, 250, 252, 0.7);
        }

        .content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 100px;
        }

        .content h2 {
            font-size: 24px;
            color: #fffa9c;
            margin-bottom: 30px;
        }

        .content p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .add-button-container {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }

        .add-button {
            width: 80px;
            height: 80px;
            background-color: #fffa9c;
            color: #1a202c;
            border: none;
            border-radius: 50%;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(255, 250, 205, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 250, 205, 0.6);
        }

        .add-button:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 28px;
            }

            .content {
                padding: 30px;
            }

            .add-button {
                width: 70px;
                height: 70px;
                font-size: 36px;
            }
        }
    </style>
</head>

<body>
<div class="container">
    <div class="header">
        <h1>音乐排行榜</h1>
        <p>探索热门音乐和艺术家</p>
    </div>

    <div class="content">
        <h2>榜单内容</h2>
        <p>这里是榜单页面的基本内容，具体内容可以根据需要进行修改和扩展。</p>
        <p>页面主要功能是展示音乐排行榜信息，用户可以浏览不同类别的榜单。</p>
        <p>点击下方的加号按钮可以跳转到添加新内容的页面。</p>
    </div>
</div>
<div class="add-button-container">
    <button class="add-button" id="addBtn">+</button>
</div>
<!-- 可伸缩的“我的榜单”按钮（放在页面右侧） -->
<div class="slide-btn-container">
    <button class="slide-btn-toggle" id="slideBtnToggle">
        <span class="toggle-icon">我的榜单</span>
    </button>
    <button class="slide-btn-content" id="myRankBtn">进入我的榜单</button>
</div>

<style>
    .slide-btn-container {
        position: fixed;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        z-index: 999;
        display: flex;
        align-items: center;
    }
    .slide-btn-toggle {
        width: 40px;
        height: 40px;
        border-radius: 50% 0 0 50%;
        background: #fffa9c;
        color: #333;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }
    .slide-btn-toggle.expanded {
        background: #fffa9c !important;
        width: 80px; /* 展开后加宽，显示文字 */
    }
    .toggle-icon {
        display: none;
        font-size: 12px;
        margin-left: 5px;
    }
    .slide-btn-toggle.expanded .toggle-icon {
        display: inline;
    }
    .slide-btn-content {
        height: 40px;
        padding: 0 15px;
        background: #333;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px 0 0 4px;
        margin-right: -1px;
        transform: translateX(100%);
        opacity: 0;
        transition: all 0.3s;
    }
    .slide-btn-content.show {
        transform: translateX(0);
        opacity: 1;
    }
    .slide-btn-content:hover {
        background: #555;
    }
</style>
</body>
<script>
    function getUrlParam(paramName) {
        const reg = new RegExp("(^|&)" + paramName + "=([^&]*)(&|$)");
        const paramMatch = window.location.search.substr(1).match(reg);
        return paramMatch ? decodeURIComponent(paramMatch[2]) : null;
    }

    // 修复2：确保showErrorTip的DOM存在（如果没有，加一个）
    function showErrorTip(msg) {
        // 如果页面没有errorAlert，动态创建一个
        let el = document.getElementById('errorAlert');
        if (!el) {
            el = document.createElement('div');
            el.id = 'errorAlert';
            el.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:10px 20px;background:#ff4444;color:#fff;border-radius:4px;z-index:9999;';
            document.body.appendChild(el);
        }
        el.innerText = msg;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 2000);
    }

    // 修复3：按钮交互+跳转逻辑
    const slideBtnToggle = document.getElementById('slideBtnToggle');
    const myRankBtn = document.getElementById('myRankBtn');
    let isExpanded = false;

    // 展开/收起按钮
    slideBtnToggle.onclick = function() {
        isExpanded = !isExpanded;
        slideBtnToggle.classList.toggle('expanded', isExpanded);
        myRankBtn.classList.toggle('show', isExpanded);
    };

    // 点击“进入我的榜单”跳转（加控制台日志，方便排查）
    myRankBtn.onclick = function() {
        const token = getUrlParam("token");
        const userId = getUrlParam("userId"); // 关键修改：和URL的userId保持一致
        console.log("当前token：", token);
        console.log("当前userId：", userId); // 打印日志也同步修改

        // 参数校验（同步修改为userId）
        if (!token || !userId || isNaN(userId)) {
            showErrorTip("缺少登录信息，请重新登录！");
            setTimeout(() => window.location.href = "/music/login.html", 1500);
            return;
        }

        // 跳转URL（同步传递userId，和后端保持一致）
        const jumpUrl = `/music/api/mine/my?token=${encodeURIComponent(token)}&userId=${userId}`;
        console.log("跳转URL：", jumpUrl);
        window.location.href = jumpUrl;
    };
    // ************************** 新增1：通用URL参数获取工具函数（核心，所有页面复用） **************************
    // 作用：从页面URL中解析出token、userId、categoryId等参数（如：publish.html?token=xxx&userId=1&categoryId=1）
    // 通用URL参数获取工具函数
    // 你的getUrlParam函数应该是这样的（如果不是，改成下面的标准写法）：
    function getUrlParam(paramName) {
        const reg = new RegExp("(^|&)" + paramName + "=([^&]*)(&|$)");
        const paramMatch = window.location.search.substr(1).match(reg);
        return paramMatch ? decodeURIComponent(paramMatch[2]) : null;
    }


    // 自定义提示方法
    function showErrorTip(msg) {
        const el = document.getElementById('errorAlert');
        el.innerText = msg;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 3000);
    }
    function showSuccessTip(msg) {
        const el = document.getElementById('successAlert');
        el.innerText = msg;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 2000);
    }

    // 全局变量
    let token = '';
    let userId = '';
    let categoryId = '';

    // 页面加载核心逻辑
    window.onload = function() {
        // 解析参数
        token = getUrlParam("token");
        userId = getUrlParam("userId");
        categoryId = getUrlParam("categoryId");

        // 类型转换+空值校验
        userId = userId ? Number(userId) : null;
        categoryId = categoryId ? Number(categoryId) : null;

        // 登录态校验
        if (!token || token.trim() === '' || !userId || isNaN(userId)) {
            showErrorTip("登录信息失效，请重新登录！");
            setTimeout(() => window.location.href = "/music/login.html", 1500);
            return;
        }
        // 分类ID校验
        if (!categoryId || isNaN(categoryId)) {
            showErrorTip("未获取到有效榜单分类，请重新选择！");
            setTimeout(() => window.location.href = "/music/index.html", 1500);
            return;
        }

        // 调试日志
        console.log("认证参数校验通过：", { token, userId, categoryId });
        showSuccessTip("页面加载成功，可发布榜单啦！");
    };

    // 加号按钮点击事件
    document.getElementById("addBtn").onclick = function() {
        if (!token || !userId || !categoryId || isNaN(userId) || isNaN(categoryId)) {
            showErrorTip("参数缺失，请刷新页面重试！");
            return;
        }
        // 编码参数+拼接/music前缀
        const jumpUrl = `/music/rank.html?token=${encodeURIComponent(token)}&userId=${userId}&categoryId=${categoryId}`;
        window.location.href = jumpUrl;
    };

    // 预留接口请求基础逻辑
    function requestApi(apiUrl, method = "GET", data = {}) {
        let fullUrl = `/music${apiUrl}?token=${encodeURIComponent(token)}&userId=${userId}&categoryId=${categoryId}`;
        const requestOptions = {
            method: method,
            headers: {
                "Content-Type": "application/json;charset=utf-8"
            }
        };
        if (method === "POST") {
            requestOptions.body = JSON.stringify(data);
        }
        return fetch(fullUrl, requestOptions)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`接口请求失败：${response.status}`);
                }
                return response.json();
            })
            .catch(error => {
                console.error("接口请求异常：", error);
                showErrorTip("接口请求失败，请检查后端服务或登录信息！");
                throw error;
            });
    }
</script>
</body>
</html>